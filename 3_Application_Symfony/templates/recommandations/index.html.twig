{% extends 'base.html.twig' %}

{% block title %}Recommandations{% endblock %}



{% block body %}
<!--Sidebar-->
<div class = 'sidebar'>
</div>

    <!--Block title-->
    <div class = 'title_block'>
        <div>
            <h1>Title</h1>
            <h4>Subtitle</h4>
        </div>
        <input class="searchBar" type="text" placeholder="Search a game">
    </div>

    


    <!--Main-container-->
    <div class="recommandations-main-container">
        <section class="games-block-container">
        {% for game in games %}
            <div class="game-block">
                <div class="game-img-container" id="game_img_container_{{game.appID}}">
                    <div class='game-img-overlay'  onclick="selectGameDashboard('{{game.appID}}')">
                    {# Rajouter icones Figma + 
                    adapter font-size pour éviter d'avoir des surprises lorsque la taille d'écran change #}
                    <div class="overlay-content" id="overlay-left">
                        <div class="overlay-content-top">
                        <p>top-left</p>
                        <p>{{game.revenue}}</p>
                        </div>
                        <div class="overlay-content-bottom">
                        <p>bottom-left</p>
                        <p>{{game.AvgPlayTime}}</p>
                        </div>
                    </div>
                    <div class="overlay-content" id="overlay-right">
                        <div class="overlay-content-top">
                        <p>top-right</p>
                        <p>{{game.copiesSold}}</p>
                        </div>
                        <div class="overlay-content-bottom">
                        <p>bottom-right</p>
                        <p>{{game.recommandations}}</p>
                        </div>
                    </div>
                    </div>
                    
                    <img class="game-img" src={{game.headerImg}}></img>
                </div>
                <img id="games_information_icon_recommandations" src="{{asset("icons/site_games_informations_icon.png")}}" type="button" onclick="afficherInfoGame('{{game.appID}}')"></img>
            </div>

            
            {% else %}
            <li>Aucuun enregistrement dans la BD</li>
        {% endfor %}
        

        <!-- Ajax -->
        <script>
            // Modal
            function afficherInfoGame(var_appID) {
                $(document).ready(function() {
                    $.ajax({
                        url: "{{ path('app_recommandations_ajax_modal') }}",
                        type: "POST",
                        dataType: "json",
                        data: {
                            appID: var_appID
                        },
                        async: true,
                        success: function (arrayDataGame) {
                            // On ecrit ici le script HTML définissant le contenu de la modal.
                            var chaineHtml = "<p>"+arrayDataGame[0].game_name+"</p><button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button>";
                            
                            // intégration du contenu de la modal dans le squelette
                            $('#gameInfoContent').html(chaineHtml);
                            // affichage de la modal.
                            $('#gameInfoModal').modal('show');
                        },
                        error: function(jqXHR){         // Fonction à appeler si la requête échoue
                            console.log("erreur modal");
                        }
                    })
                });
            }

            // Dynamic count of selected games
            // No need to send data to the Controller, we just want to call the Ajax function of the Controller. 
            function countSelectedGame() {
                $(document).ready(function() {
                    $.ajax({
                        url: "{{ path('app_recommandations_ajax_count') }}",
                        type: "POST",
                        async: true,
                        success: function (accountSelectedGame) {
                            var chaineHtml = "\
                                <p>"+accountSelectedGame+"</p>\
                                ";
                            
                            // intégration du contenu de la modal dans le squelette
                            $('#index-continue-btn').html(chaineHtml);

                        },
                        error: function(jqXHR){         // Fonction à appeler si la requête échoue
                            console.log("erreur count");
                        }
                    })
                });
            }


            // Select game for dashboard - call we we click on a game to select him.
            function selectGameDashboard(var_appID) {
                $(document).ready(function() {
                    $.ajax({
                        url: "{{ path('app_recommandations_ajax_select') }}",
                        type: "POST",
                        dataType: "json",
                        data: {
                            appID: var_appID
                        },
                        async: true,
                        success: function (header_img) {
                            //console.log(header_img);
                            var chaineHtml = "\
                                <div class='game-img-overlay-success' onclick='unselectGameDashboard("+var_appID+")'>\
                                    <p>test</p>\
                                </div>\
                                <img class='game-img' src="+header_img+"></img>\
                                ";
                            
                            // intégration du contenu Html dans le squelette
                            $('#game_img_container_'+ var_appID).html(chaineHtml);
                            countSelectedGame();
                        },
                        error: function(jqXHR){         // Fonction à appeler si la requête échoue
                            console.log("erreur select");
                            console.log(var_appID);
                        }
                    })
                });
            }



            // Remove a game from dashboard selection table - call we we click on a game to unselect him.
            function unselectGameDashboard(var_appID) {
                $(document).ready(function() {
                    $.ajax({
                        url: "{{ path('app_recommandations_ajax_unselect') }}",
                        type: "POST",
                        dataType: "json",
                        data: {
                            appID: var_appID
                        },
                        async: true,
                        success: function (arrayDataGame) {
                            // this var is about to change when we will change graphic aspect of the website.
                            // We must add icons and change the css to make things good.
                            var chaineHtml = "\
                                <div class='game-img-overlay'  onclick='selectGameDashboard("+var_appID+")'>\
                                    <div class='overlay-content' id='overlay-left'>\
                                        <div class='overlay-content-top'>\
                                        <p>top-left</p>\
                                        <p>"+arrayDataGame.revenue+"</p>\
                                        </div>\
                                        <div class='overlay-content-bottom'>\
                                        <p>bottom-left</p>\
                                        <p>"+arrayDataGame.avg_play_time+"</p>\
                                        </div>\
                                    </div>\
                                    <div class='overlay-content' id='overlay-right'>\
                                        <div class='overlay-content-top'>\
                                        <p>top-right</p>\
                                        <p>"+arrayDataGame.copies_sold+"</p>\
                                        </div>\
                                        <div class='overlay-content-bottom'>\
                                        <p>bottom-right</p>\
                                        <p>"+arrayDataGame.recommandations+"</p>\
                                        </div>\
                                    </div>\
                                    </div>\
                                    <img class='game-img' src="+arrayDataGame.header_img+"></img>\
                                </div>\
                            ";
                            
                            // intégration du contenu de la modal dans le squelette
                            $('#game_img_container_'+ var_appID).html(chaineHtml);
                            countSelectedGame();
                        },
                        error: function(jqXHR){         // Fonction à appeler si la requête échoue
                            console.log("erreur unselect");
                            console.log(var_appID);
                        }
                    })
                });
            }
        </script>

        <!-- Modal -->
        {#
        Ici, la modal est vide, on initialise uniquement le squelette qui est 
        ensuite rempli dans une requête AJAX.
        #}
        <div class="modal fade" id="gameInfoModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered infoModal">
            <div class="modal-content">
            <div class="modal-body" id="gameInfoContent">
            </div>
            </div>
        </div>
        </div>


        </section>
        <div id="recommandations-to-dashboard-btn-container">
        <a type="button" id="recommandations-to-dashboard-btn" class="btn btn-primary" href ="{{ path('app_recommandations_dashobard') }}">Continue 🞂</a>
        <a type="button" id="index-continue-btn" class="btn btn-primary">0</a>
        </div>
    </div>
{% endblock %}
