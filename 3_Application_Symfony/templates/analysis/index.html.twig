{% extends 'base.html.twig' %}

{% block title %}Hello AnalysisController!{% endblock %}

{% block body %}
<div "main-container-analysis-page">
    <h1>Analysis</h1>
    {% for viewLine in viewGraphFiveDim %}
                <div>
                    <div>
                        <h3>Nom du genre : {{viewLine.label}}</h3>
                        <p>Nombre de jeux : {{viewLine.nbGames}}</p>
                        <p>Note moyenne : {{viewLine.avgReviewScore}}</p>
                    </div>
                </div>
    {% endfor %} 
    <div class="graphFiveDim-container">
        <canva>{{render_chart(chartFiveDim)}}</canva>
    </div>    


    


    <section class="graphPeriodGenre-container">
        <canvas id="graphPeriodGenre"></canvas>
        <div id="radio-button-period-container">
        {{form_start(form)}}            
        {{ form_widget(form.testForm, {'attr': {'class': 'radio-btn-period-container', 'onclick' : "afficherGraphPeriodGenre()"}}) }}
        {# {{ form_rest(form) }}
        <button type="submit">Enregistrer</button> #}
        {{form_end(form)}} 
        </div>
    </section>  

    


    <script>
        function afficherGraphPeriodGenre() {
            // Récupération de la valeur sélectionnée dans les radioButton.
            const var_period = document.querySelector('input[type="radio"][name="form[testForm]"]:checked').value;

            // Requête Ajax qui envoie la valeur de la constante précédente dans le controller avant
            // d'utiliser la valeur renvoyée par le controller pour construire un grahe et 
            // mettre à jour le canvas.
				$.ajax({
					url: "{{ path('app_analysis_ajax_graph_period') }}",
					type: "POST",
					dataType: "json",
					data: {
						period : var_period
					},
					success: function (response) {
                        console.log(response);
                        var ctx = $("#graphPeriodGenre");
                        
                        var myChart = new Chart(
                            ctx, 
                            {
                                type: 'line', 
                                data: { 
                                    labels: response.data.label, 
                                    datasets: response.data.datasets
                                }, 
                                options :{
                                    scales : {
                                        x:{
                                            title:{
                                                display : true, 
                                                text : var_period
                                            }
                                        }, 
                                        y:{
                                            title:{
                                                display : true, 
                                                text : 'Copies Sold (Millions)'
                                            }
                                        }
                                    }
                                } 
                            }
                        );
                        console.log(myChart);
                        myChart.update();
					},
                    error: function(jqXHR){         // Fonction à appeler si la requête échoue
						console.log("erreur affichage graphe PeriodGenre");
					}
			});
		}
    </script>


    
    
    
</div>
{% endblock %}
{% block lastScripts %}
    <script>
        document.querySelector('input[type="radio"][name="form[testForm]"]:checked').click();
    </script>
{% endblock %}